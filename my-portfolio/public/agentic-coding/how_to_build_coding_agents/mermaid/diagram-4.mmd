---
config:
  look: neo
  theme: base
  themeVariables:
    fontFamily: 'Inter, ui-sans-serif, system-ui'
    fontSize: '16px'
    primaryTextColor: '#0F172A'
    lineColor: '#334155'
    edgeLabelBackground: '#FFFFFF'
    clusterTextSize: '15px'
    clusterTextWeight: '600'
    borderRadius: '4'
    shadowColor: '#000000'
    shadowOpacity: '0.12'
    shadowBlur: '4'
  flowchart:
    curve: basis
    nodeSpacing: 50
    rankSpacing: 70
---
flowchart LR
  subgraph Client[Client IDE]
    FS[Repo Files]
    MTc[Merkle Tree client]
    CH[Changed files]
  end

  subgraph Server[Server Index Service]
    MTs[Merkle Tree server]
    IDX[Embedding / Symbol Index]
  end

  FS --> MTc
  MTc -- hash roots --> Server
  MTs -- compare roots --> Server
  Server --> CH
  CH -- send only diffs/chunks --> Server
  Server --> IDX

  classDef c fill:#E0F2FE,stroke:#38BDF8,stroke-width:2px,color:#0F172A;
  classDef s fill:#DCFCE7,stroke:#4ADE80,stroke-width:2px,color:#0F172A;
  class Client,FS,MTc,CH c;
  class Server,MTs,IDX s;

  style Client fill:#F8FAFC,stroke:#94A3B8,stroke-width:2px,rx:6,ry:6,font-size:15px,font-weight:600
  style Server fill:#F8FAFC,stroke:#94A3B8,stroke-width:2px,rx:6,ry:6,font-size:15px,font-weight:600
