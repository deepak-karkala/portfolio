---
config:
  look: neo
  theme: base
  themeVariables:
    fontFamily: 'Inter, ui-sans-serif, system-ui'
    fontSize: '16px'
    primaryTextColor: '#0F172A'
    lineColor: '#334155'
    edgeLabelBackground: '#FFFFFF'
    clusterTextSize: '15px'
    clusterTextWeight: '600'
    borderRadius: '4'
    shadowColor: '#000000'
    shadowOpacity: '0.12'
    shadowBlur: '4'
  flowchart:
    curve: basis
    nodeSpacing: 50
    rankSpacing: 70
---
flowchart LR
  U[User] --> UX[CLI / IDE UI<br/>chat + commands + diff view]

  subgraph AR[Agent Runtime: Master Loop]
    P[Planner / Policy Prompt<br/>system + project rules]
    L[Agent Loop<br/>decide -> tool -> observe]
    M[Memory / Scratchpad<br/>todos + summaries]
  end

  UX --> L
  P --> L
  M --> L

  subgraph TL[Tool Layer]
    R[read_file / read_range]
    G[grep / search]
    E[edit_patch / apply_diff]
    B[bash / run]
    W[web_fetch optional]
    SA[subagent task]
  end

  L --> R
  L --> G
  L --> E
  L --> B
  L --> W
  L --> SA

  subgraph VFY[Verification Ladder]
    F[format/lint]
    T[unit tests]
    IT[integration/build]
    RT[runtime e2e]
  end

  B --> F
  B --> T
  B --> IT
  B --> RT
  F --> L
  T --> L
  IT --> L
  RT --> L

  subgraph OBS[Observability]
    TR[trace + spans]
    MET[metrics]
    LOG[structured logs]
  end

  L --> TR
  TL --> TR
  VFY --> TR
  TR --> MET
  TR --> LOG

  classDef ui fill:#E0F2FE,stroke:#38BDF8,stroke-width:2px,color:#0F172A;
  classDef agent fill:#DCFCE7,stroke:#4ADE80,stroke-width:2px,color:#0F172A;
  classDef tools fill:#FFEDD5,stroke:#FB923C,stroke-width:2px,color:#0F172A;
  classDef vfy fill:#FCE7F3,stroke:#F472B6,stroke-width:2px,color:#0F172A;
  classDef obs fill:#EDE9FE,stroke:#8B5CF6,stroke-width:2px,color:#0F172A;

  class UX,U ui;
  class AR,P,L,M agent;
  class TL,R,G,E,B,W,SA tools;
  class VFY,F,T,IT,RT vfy;
  class OBS,TR,MET,LOG obs;

  style AR fill:#F8FAFC,stroke:#94A3B8,stroke-width:2px,rx:6,ry:6,font-size:15px,font-weight:600
  style TL fill:#F8FAFC,stroke:#94A3B8,stroke-width:2px,rx:6,ry:6,font-size:15px,font-weight:600
  style VFY fill:#F8FAFC,stroke:#94A3B8,stroke-width:2px,rx:6,ry:6,font-size:15px,font-weight:600
  style OBS fill:#F8FAFC,stroke:#94A3B8,stroke-width:2px,rx:6,ry:6,font-size:15px,font-weight:600
