---
config:
  look: neo
  theme: base
  themeVariables:
    fontFamily: 'Inter, ui-sans-serif, system-ui'
    fontSize: '16px'
    primaryTextColor: '#0F172A'
    lineColor: '#334155'
    edgeLabelBackground: '#FFFFFF'
    clusterTextSize: '15px'
    clusterTextWeight: '600'
    borderRadius: '4'
    shadowColor: '#000000'
    shadowOpacity: '0.12'
    shadowBlur: '4'
---
sequenceDiagram
  autonumber
  participant Agent
  participant Trace as Tracer
  participant LLM
  participant Tool as Tool Exec
  participant Ver as Verifier
  participant Store as Log/Metrics Store

  Agent->>Trace: start_trace(run_id, task_type)
  Agent->>Trace: start_span("llm_decide")
  Agent->>LLM: prompt(context)
  LLM-->>Agent: action(tool,args)
  Agent->>Trace: end_span("llm_decide", tokens, latency)

  Agent->>Trace: start_span("tool_call")
  Agent->>Tool: exec(tool,args)
  Tool-->>Agent: result(exit, stdout/stderr)
  Agent->>Trace: end_span("tool_call", latency, exit_code)

  Agent->>Trace: start_span("verify")
  Agent->>Ver: evaluate(test/lint)
  Ver-->>Agent: pass/fail + summary
  Agent->>Trace: end_span("verify", latency, status)

  Agent->>Store: emit metrics + structured logs
  Agent->>Trace: end_trace(status=success|fail|human)
